{"version":3,"sources":["js/helper/TrackballControls.js"],"names":["THREE","TrackballControls","object","domElement","_this","STATE","NONE","ROTATE","ZOOM","PAN","TOUCH_ROTATE","TOUCH_ZOOM_PAN","undefined","document","enabled","screen","left","top","width","height","rotateSpeed","zoomSpeed","panSpeed","noRotate","noZoom","noPan","staticMoving","dynamicDampingFactor","minDistance","maxDistance","Infinity","keys","target","Vector3","EPS","lastPosition","_state","_prevState","_eye","_movePrev","Vector2","_moveCurr","_lastAxis","_lastAngle","_zoomStart","_zoomEnd","_touchZoomDistanceStart","_touchZoomDistanceEnd","_panStart","_panEnd","target0","clone","position0","position","up0","up","changeEvent","type","startEvent","endEvent","handleResize","window","innerWidth","innerHeight","box","getBoundingClientRect","d","ownerDocument","documentElement","pageXOffset","clientLeft","pageYOffset","clientTop","getMouseOnScreen","vector","pageX","pageY","set","getMouseOnCircle","rotateCamera","axis","quaternion","Quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","angle","x","y","length","copy","sub","normalize","crossVectors","setLength","add","setFromAxisAngle","applyQuaternion","Math","sqrt","zoomCamera","factor","multiplyScalar","panCamera","mouseChange","objectUp","pan","lengthSq","cross","subVectors","checkDistances","addVectors","update","lookAt","distanceToSquared","dispatchEvent","reset","keydown","event","removeEventListener","keyCode","keyup","addEventListener","mousedown","preventDefault","stopPropagation","button","mousemove","mouseup","mousewheel","deltaMode","deltaY","touchstart","touches","dx","dy","touchmove","touchend","contextmenu","dispose","prototype","Object","create","EventDispatcher","constructor"],"mappings":"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","file":"TrackballControls.2384f871.js","sourceRoot":"..","sourcesContent":["/**\r\n * @author Eberhard Graether / http://egraether.com/\r\n * @author Mark Lundin \t/ http://mark-lundin.com\r\n * @author Simone Manini / http://daron1337.github.io\r\n * @author Luca Antiga \t/ http://lantiga.github.io\r\n */\r\n\r\nTHREE.TrackballControls = function (object, domElement) {\r\n\r\n\tvar _this = this;\r\n\tvar STATE = { NONE: - 1, ROTATE: 0, ZOOM: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_ZOOM_PAN: 4 };\r\n\r\n\tthis.object = object;\r\n\tthis.domElement = (domElement !== undefined) ? domElement : document;\r\n\r\n\t// API\r\n\r\n\tthis.enabled = true;\r\n\r\n\tthis.screen = { left: 0, top: 0, width: 0, height: 0 };\r\n\r\n\tthis.rotateSpeed = 1.0;\r\n\tthis.zoomSpeed = 1.2;\r\n\tthis.panSpeed = 0.3;\r\n\r\n\tthis.noRotate = false;\r\n\tthis.noZoom = false;\r\n\tthis.noPan = false;\r\n\r\n\tthis.staticMoving = false;\r\n\tthis.dynamicDampingFactor = 0.2;\r\n\r\n\tthis.minDistance = 0;\r\n\tthis.maxDistance = Infinity;\r\n\r\n\tthis.keys = [65 /*A*/, 83 /*S*/, 68 /*D*/];\r\n\r\n\t// internals\r\n\r\n\tthis.target = new THREE.Vector3();\r\n\r\n\tvar EPS = 0.000001;\r\n\r\n\tvar lastPosition = new THREE.Vector3();\r\n\r\n\tvar _state = STATE.NONE,\r\n\t\t_prevState = STATE.NONE,\r\n\r\n\t\t_eye = new THREE.Vector3(),\r\n\r\n\t\t_movePrev = new THREE.Vector2(),\r\n\t\t_moveCurr = new THREE.Vector2(),\r\n\r\n\t\t_lastAxis = new THREE.Vector3(),\r\n\t\t_lastAngle = 0,\r\n\r\n\t\t_zoomStart = new THREE.Vector2(),\r\n\t\t_zoomEnd = new THREE.Vector2(),\r\n\r\n\t\t_touchZoomDistanceStart = 0,\r\n\t\t_touchZoomDistanceEnd = 0,\r\n\r\n\t\t_panStart = new THREE.Vector2(),\r\n\t\t_panEnd = new THREE.Vector2();\r\n\r\n\t// for reset\r\n\r\n\tthis.target0 = this.target.clone();\r\n\tthis.position0 = this.object.position.clone();\r\n\tthis.up0 = this.object.up.clone();\r\n\r\n\t// events\r\n\r\n\tvar changeEvent = { type: 'change' };\r\n\tvar startEvent = { type: 'start' };\r\n\tvar endEvent = { type: 'end' };\r\n\r\n\r\n\t// methods\r\n\r\n\tthis.handleResize = function () {\r\n\r\n\t\tif (this.domElement === document) {\r\n\r\n\t\t\tthis.screen.left = 0;\r\n\t\t\tthis.screen.top = 0;\r\n\t\t\tthis.screen.width = window.innerWidth;\r\n\t\t\tthis.screen.height = window.innerHeight;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar box = this.domElement.getBoundingClientRect();\r\n\t\t\t// adjustments come from similar code in the jquery offset() function\r\n\t\t\tvar d = this.domElement.ownerDocument.documentElement;\r\n\t\t\tthis.screen.left = box.left + window.pageXOffset - d.clientLeft;\r\n\t\t\tthis.screen.top = box.top + window.pageYOffset - d.clientTop;\r\n\t\t\tthis.screen.width = box.width;\r\n\t\t\tthis.screen.height = box.height;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tvar getMouseOnScreen = (function () {\r\n\r\n\t\tvar vector = new THREE.Vector2();\r\n\r\n\t\treturn function getMouseOnScreen(pageX, pageY) {\r\n\r\n\t\t\tvector.set(\r\n\t\t\t\t(pageX - _this.screen.left) / _this.screen.width,\r\n\t\t\t\t(pageY - _this.screen.top) / _this.screen.height\r\n\t\t\t);\r\n\r\n\t\t\treturn vector;\r\n\r\n\t\t};\r\n\r\n\t}());\r\n\r\n\tvar getMouseOnCircle = (function () {\r\n\r\n\t\tvar vector = new THREE.Vector2();\r\n\r\n\t\treturn function getMouseOnCircle(pageX, pageY) {\r\n\r\n\t\t\tvector.set(\r\n\t\t\t\t((pageX - _this.screen.width * 0.5 - _this.screen.left) / (_this.screen.width * 0.5)),\r\n\t\t\t\t((_this.screen.height + 2 * (_this.screen.top - pageY)) / _this.screen.width) // screen.width intentional\r\n\t\t\t);\r\n\r\n\t\t\treturn vector;\r\n\r\n\t\t};\r\n\r\n\t}());\r\n\r\n\tthis.rotateCamera = (function () {\r\n\r\n\t\tvar axis = new THREE.Vector3(),\r\n\t\t\tquaternion = new THREE.Quaternion(),\r\n\t\t\teyeDirection = new THREE.Vector3(),\r\n\t\t\tobjectUpDirection = new THREE.Vector3(),\r\n\t\t\tobjectSidewaysDirection = new THREE.Vector3(),\r\n\t\t\tmoveDirection = new THREE.Vector3(),\r\n\t\t\tangle;\r\n\r\n\t\treturn function rotateCamera() {\r\n\r\n\t\t\tmoveDirection.set(_moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0);\r\n\t\t\tangle = moveDirection.length();\r\n\r\n\t\t\tif (angle) {\r\n\r\n\t\t\t\t_eye.copy(_this.object.position).sub(_this.target);\r\n\r\n\t\t\t\teyeDirection.copy(_eye).normalize();\r\n\t\t\t\tobjectUpDirection.copy(_this.object.up).normalize();\r\n\t\t\t\tobjectSidewaysDirection.crossVectors(objectUpDirection, eyeDirection).normalize();\r\n\r\n\t\t\t\tobjectUpDirection.setLength(_moveCurr.y - _movePrev.y);\r\n\t\t\t\tobjectSidewaysDirection.setLength(_moveCurr.x - _movePrev.x);\r\n\r\n\t\t\t\tmoveDirection.copy(objectUpDirection.add(objectSidewaysDirection));\r\n\r\n\t\t\t\taxis.crossVectors(moveDirection, _eye).normalize();\r\n\r\n\t\t\t\tangle *= _this.rotateSpeed;\r\n\t\t\t\tquaternion.setFromAxisAngle(axis, angle);\r\n\r\n\t\t\t\t_eye.applyQuaternion(quaternion);\r\n\t\t\t\t_this.object.up.applyQuaternion(quaternion);\r\n\r\n\t\t\t\t_lastAxis.copy(axis);\r\n\t\t\t\t_lastAngle = angle;\r\n\r\n\t\t\t} else if (!_this.staticMoving && _lastAngle) {\r\n\r\n\t\t\t\t_lastAngle *= Math.sqrt(1.0 - _this.dynamicDampingFactor);\r\n\t\t\t\t_eye.copy(_this.object.position).sub(_this.target);\r\n\t\t\t\tquaternion.setFromAxisAngle(_lastAxis, _lastAngle);\r\n\t\t\t\t_eye.applyQuaternion(quaternion);\r\n\t\t\t\t_this.object.up.applyQuaternion(quaternion);\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_movePrev.copy(_moveCurr);\r\n\r\n\t\t};\r\n\r\n\t}());\r\n\r\n\r\n\tthis.zoomCamera = function () {\r\n\r\n\t\tvar factor;\r\n\r\n\t\tif (_state === STATE.TOUCH_ZOOM_PAN) {\r\n\r\n\t\t\tfactor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\r\n\t\t\t_touchZoomDistanceStart = _touchZoomDistanceEnd;\r\n\t\t\t_eye.multiplyScalar(factor);\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfactor = 1.0 + (_zoomEnd.y - _zoomStart.y) * _this.zoomSpeed;\r\n\r\n\t\t\tif (factor !== 1.0 && factor > 0.0) {\r\n\r\n\t\t\t\t_eye.multiplyScalar(factor);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (_this.staticMoving) {\r\n\r\n\t\t\t\t_zoomStart.copy(_zoomEnd);\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_zoomStart.y += (_zoomEnd.y - _zoomStart.y) * this.dynamicDampingFactor;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.panCamera = (function () {\r\n\r\n\t\tvar mouseChange = new THREE.Vector2(),\r\n\t\t\tobjectUp = new THREE.Vector3(),\r\n\t\t\tpan = new THREE.Vector3();\r\n\r\n\t\treturn function panCamera() {\r\n\r\n\t\t\tmouseChange.copy(_panEnd).sub(_panStart);\r\n\r\n\t\t\tif (mouseChange.lengthSq()) {\r\n\r\n\t\t\t\tmouseChange.multiplyScalar(_eye.length() * _this.panSpeed);\r\n\r\n\t\t\t\tpan.copy(_eye).cross(_this.object.up).setLength(mouseChange.x);\r\n\t\t\t\tpan.add(objectUp.copy(_this.object.up).setLength(mouseChange.y));\r\n\r\n\t\t\t\t_this.object.position.add(pan);\r\n\t\t\t\t_this.target.add(pan);\r\n\r\n\t\t\t\tif (_this.staticMoving) {\r\n\r\n\t\t\t\t\t_panStart.copy(_panEnd);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t_panStart.add(mouseChange.subVectors(_panEnd, _panStart).multiplyScalar(_this.dynamicDampingFactor));\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}());\r\n\r\n\tthis.checkDistances = function () {\r\n\r\n\t\tif (!_this.noZoom || !_this.noPan) {\r\n\r\n\t\t\tif (_eye.lengthSq() > _this.maxDistance * _this.maxDistance) {\r\n\r\n\t\t\t\t_this.object.position.addVectors(_this.target, _eye.setLength(_this.maxDistance));\r\n\t\t\t\t_zoomStart.copy(_zoomEnd);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (_eye.lengthSq() < _this.minDistance * _this.minDistance) {\r\n\r\n\t\t\t\t_this.object.position.addVectors(_this.target, _eye.setLength(_this.minDistance));\r\n\t\t\t\t_zoomStart.copy(_zoomEnd);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.update = function () {\r\n\r\n\t\t_eye.subVectors(_this.object.position, _this.target);\r\n\r\n\t\tif (!_this.noRotate) {\r\n\r\n\t\t\t_this.rotateCamera();\r\n\r\n\t\t}\r\n\r\n\t\tif (!_this.noZoom) {\r\n\r\n\t\t\t_this.zoomCamera();\r\n\r\n\t\t}\r\n\r\n\t\tif (!_this.noPan) {\r\n\r\n\t\t\t_this.panCamera();\r\n\r\n\t\t}\r\n\r\n\t\t_this.object.position.addVectors(_this.target, _eye);\r\n\r\n\t\t_this.checkDistances();\r\n\r\n\t\t_this.object.lookAt(_this.target);\r\n\r\n\t\tif (lastPosition.distanceToSquared(_this.object.position) > EPS) {\r\n\r\n\t\t\t_this.dispatchEvent(changeEvent);\r\n\r\n\t\t\tlastPosition.copy(_this.object.position);\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.reset = function () {\r\n\r\n\t\t_state = STATE.NONE;\r\n\t\t_prevState = STATE.NONE;\r\n\r\n\t\t_this.target.copy(_this.target0);\r\n\t\t_this.object.position.copy(_this.position0);\r\n\t\t_this.object.up.copy(_this.up0);\r\n\r\n\t\t_eye.subVectors(_this.object.position, _this.target);\r\n\r\n\t\t_this.object.lookAt(_this.target);\r\n\r\n\t\t_this.dispatchEvent(changeEvent);\r\n\r\n\t\tlastPosition.copy(_this.object.position);\r\n\r\n\t};\r\n\r\n\t// listeners\r\n\r\n\tfunction keydown(event) {\r\n\r\n\t\tif (_this.enabled === false) return;\r\n\r\n\t\twindow.removeEventListener('keydown', keydown);\r\n\r\n\t\t_prevState = _state;\r\n\r\n\t\tif (_state !== STATE.NONE) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t} else if (event.keyCode === _this.keys[STATE.ROTATE] && !_this.noRotate) {\r\n\r\n\t\t\t_state = STATE.ROTATE;\r\n\r\n\t\t} else if (event.keyCode === _this.keys[STATE.ZOOM] && !_this.noZoom) {\r\n\r\n\t\t\t_state = STATE.ZOOM;\r\n\r\n\t\t} else if (event.keyCode === _this.keys[STATE.PAN] && !_this.noPan) {\r\n\r\n\t\t\t_state = STATE.PAN;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction keyup(event) {\r\n\r\n\t\tif (_this.enabled === false) return;\r\n\r\n\t\t_state = _prevState;\r\n\r\n\t\twindow.addEventListener('keydown', keydown, false);\r\n\r\n\t}\r\n\r\n\tfunction mousedown(event) {\r\n\r\n\t\tif (_this.enabled === false) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tif (_state === STATE.NONE) {\r\n\r\n\t\t\t_state = event.button;\r\n\r\n\t\t}\r\n\r\n\t\tif (_state === STATE.ROTATE && !_this.noRotate) {\r\n\r\n\t\t\t_moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\r\n\t\t\t_movePrev.copy(_moveCurr);\r\n\r\n\t\t} else if (_state === STATE.ZOOM && !_this.noZoom) {\r\n\r\n\t\t\t_zoomStart.copy(getMouseOnScreen(event.pageX, event.pageY));\r\n\t\t\t_zoomEnd.copy(_zoomStart);\r\n\r\n\t\t} else if (_state === STATE.PAN && !_this.noPan) {\r\n\r\n\t\t\t_panStart.copy(getMouseOnScreen(event.pageX, event.pageY));\r\n\t\t\t_panEnd.copy(_panStart);\r\n\r\n\t\t}\r\n\r\n\t\t// document.addEventListener( 'mousemove', mousemove, false );\r\n\t\t// document.addEventListener( 'mouseup', mouseup, false );\r\n\r\n\t\t_this.dispatchEvent(startEvent);\r\n\r\n\t}\r\n\r\n\tfunction mousemove(event) {\r\n\r\n\t\tif (_this.enabled === false) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tif (_state === STATE.ROTATE && !_this.noRotate) {\r\n\r\n\t\t\t_movePrev.copy(_moveCurr);\r\n\t\t\t_moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\r\n\r\n\t\t} else if (_state === STATE.ZOOM && !_this.noZoom) {\r\n\r\n\t\t\t_zoomEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\r\n\r\n\t\t} else if (_state === STATE.PAN && !_this.noPan) {\r\n\r\n\t\t\t_panEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction mouseup(event) {\r\n\r\n\t\tif (_this.enabled === false) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\t_state = STATE.NONE;\r\n\r\n\t\tdocument.removeEventListener('mousemove', mousemove);\r\n\t\tdocument.removeEventListener('mouseup', mouseup);\r\n\t\t_this.dispatchEvent(endEvent);\r\n\r\n\t}\r\n\r\n\tfunction mousewheel(event) {\r\n\r\n\t\tif (_this.enabled === false) return;\r\n\r\n\t\tif (_this.noZoom === true) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tswitch (event.deltaMode) {\r\n\r\n\t\t\tcase 2:\r\n\t\t\t\t// Zoom in pages\r\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.025;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\t// Zoom in lines\r\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.01;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\t// undefined, 0, assume pixels\r\n\t\t\t\t_zoomStart.y -= event.deltaY * 0.00025;\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\t_this.dispatchEvent(startEvent);\r\n\t\t_this.dispatchEvent(endEvent);\r\n\r\n\t}\r\n\r\n\tfunction touchstart(event) {\r\n\r\n\t\tif (_this.enabled === false) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tswitch (event.touches.length) {\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\r\n\t\t\t\t_moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\r\n\t\t\t\t_movePrev.copy(_moveCurr);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault: // 2 or more\r\n\t\t\t\t_state = STATE.TOUCH_ZOOM_PAN;\r\n\t\t\t\tvar dx = event.touches[0].pageX - event.touches[1].pageX;\r\n\t\t\t\tvar dy = event.touches[0].pageY - event.touches[1].pageY;\r\n\t\t\t\t_touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt(dx * dx + dy * dy);\r\n\r\n\t\t\t\tvar x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\r\n\t\t\t\tvar y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\r\n\t\t\t\t_panStart.copy(getMouseOnScreen(x, y));\r\n\t\t\t\t_panEnd.copy(_panStart);\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\t_this.dispatchEvent(startEvent);\r\n\r\n\t}\r\n\r\n\tfunction touchmove(event) {\r\n\r\n\t\tif (_this.enabled === false) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tswitch (event.touches.length) {\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\t_movePrev.copy(_moveCurr);\r\n\t\t\t\t_moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault: // 2 or more\r\n\t\t\t\tvar dx = event.touches[0].pageX - event.touches[1].pageX;\r\n\t\t\t\tvar dy = event.touches[0].pageY - event.touches[1].pageY;\r\n\t\t\t\t_touchZoomDistanceEnd = Math.sqrt(dx * dx + dy * dy);\r\n\r\n\t\t\t\tvar x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\r\n\t\t\t\tvar y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\r\n\t\t\t\t_panEnd.copy(getMouseOnScreen(x, y));\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction touchend(event) {\r\n\r\n\t\tif (_this.enabled === false) return;\r\n\r\n\t\tswitch (event.touches.length) {\r\n\r\n\t\t\tcase 0:\r\n\t\t\t\t_state = STATE.NONE;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\t_state = STATE.TOUCH_ROTATE;\r\n\t\t\t\t_moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\r\n\t\t\t\t_movePrev.copy(_moveCurr);\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\t_this.dispatchEvent(endEvent);\r\n\r\n\t}\r\n\r\n\tfunction contextmenu(event) {\r\n\r\n\t\tif (_this.enabled === false) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t}\r\n\r\n\tthis.dispose = function () {\r\n\r\n\t\tthis.domElement.removeEventListener('contextmenu', contextmenu, false);\r\n\t\tthis.domElement.removeEventListener('mousedown', mousedown, false);\r\n\t\tthis.domElement.removeEventListener('wheel', mousewheel, false);\r\n\r\n\t\tthis.domElement.removeEventListener('touchstart', touchstart, false);\r\n\t\tthis.domElement.removeEventListener('touchend', touchend, false);\r\n\t\tthis.domElement.removeEventListener('touchmove', touchmove, false);\r\n\r\n\t\tdocument.removeEventListener('mousemove', mousemove, false);\r\n\t\tdocument.removeEventListener('mouseup', mouseup, false);\r\n\r\n\t\twindow.removeEventListener('keydown', keydown, false);\r\n\t\twindow.removeEventListener('keyup', keyup, false);\r\n\r\n\t};\r\n\r\n\tthis.domElement.addEventListener('contextmenu', contextmenu, false);\r\n\tthis.domElement.addEventListener('mousedown', mousedown, false);\r\n\tthis.domElement.addEventListener('wheel', mousewheel, false);\r\n\r\n\tthis.domElement.addEventListener('touchstart', touchstart, false);\r\n\tthis.domElement.addEventListener('touchend', touchend, false);\r\n\tthis.domElement.addEventListener('touchmove', touchmove, false);\r\n\r\n\twindow.addEventListener('keydown', keydown, false);\r\n\twindow.addEventListener('keyup', keyup, false);\r\n\r\n\tthis.handleResize();\r\n\r\n\t// force an update at start\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.TrackballControls.prototype = Object.create(THREE.EventDispatcher.prototype);\r\nTHREE.TrackballControls.prototype.constructor = THREE.TrackballControls;\r\n"]}